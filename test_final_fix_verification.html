<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€ç»ˆä¿®å¤éªŒè¯æµ‹è¯•</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="frontend/css/styles.css">
    <style>
        .fix-summary {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .test-button {
            margin: 10px;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            font-weight: 500;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-info { background: #17a2b8; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .test-result {
            margin: 10px 0;
            padding: 12px;
            border-radius: 6px;
            font-size: 13px;
            border-left: 4px solid;
        }
        .result-success { 
            background: #d4edda; 
            color: #155724; 
            border-left-color: #28a745;
        }
        .result-error { 
            background: #f8d7da; 
            color: #721c24; 
            border-left-color: #dc3545;
        }
        .result-info { 
            background: #d1ecf1; 
            color: #0c5460; 
            border-left-color: #17a2b8;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .feature-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online { background: #28a745; }
        .status-offline { background: #dc3545; }
        .status-warning { background: #ffc107; }
    </style>
</head>
<body>
    <div class="container" style="padding: 20px;">
        <h1>ğŸ‰ æœ€ç»ˆä¿®å¤éªŒè¯æµ‹è¯•</h1>
        
        <div class="fix-summary">
            <h2>âœ… é—®é¢˜å®Œå…¨è§£å†³</h2>
            <p><strong>åŸé—®é¢˜ï¼š</strong>ä»»åŠ¡è°ƒåº¦é¡µé¢æ˜¾ç¤º"æ­£åœ¨å¼€å‘"ï¼Œ"æ‰“å¼€ç›‘æ§é¡µé¢"æŒ‰é’®ç‚¹å‡»æ— å“åº”</p>
            <p><strong>æ ¹æœ¬åŸå› ï¼š</strong>Vueè·¯ç”±ä¸å¯ç”¨æ—¶ï¼Œå›é€€æ–¹æ¡ˆä¸­çš„ <code>openMonitoring()</code> å‡½æ•°æ²¡æœ‰å®é™…åˆ›å»ºç›‘æ§é¡µé¢</p>
            <p><strong>å®Œæ•´è§£å†³æ–¹æ¡ˆï¼š</strong>å®ç°äº†åŠŸèƒ½å®Œæ•´çš„ç›‘æ§é¡µé¢å›é€€æ–¹æ¡ˆï¼ŒåŒ…å«ç³»ç»ŸçŠ¶æ€ã€GPUç›‘æ§ã€ä»»åŠ¡ä¿¡æ¯å’Œæ—¥å¿—æŸ¥çœ‹</p>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”§ ä¿®å¤è¯¦æƒ…</h2>
            
            <div class="feature-list">
                <div class="feature-item">
                    <h4><i class="fas fa-chart-line"></i> ç›‘æ§é¡µé¢å›é€€</h4>
                    <p>åˆ›å»ºäº†å®Œæ•´çš„ <code>createMonitoringPage()</code> å‡½æ•°ï¼Œæä¾›ç³»ç»Ÿç›‘æ§åŠŸèƒ½</p>
                </div>
                <div class="feature-item">
                    <h4><i class="fas fa-tachometer-alt"></i> ç³»ç»ŸçŠ¶æ€</h4>
                    <p>å®ç°äº† <code>loadSystemOverview()</code> å‡½æ•°ï¼Œæ˜¾ç¤ºè¿è¡Œæ¨¡å‹æ•°ã€GPUæ•°é‡ç­‰</p>
                </div>
                <div class="feature-item">
                    <h4><i class="fas fa-microchip"></i> GPUç›‘æ§</h4>
                    <p>å®ç°äº† <code>loadGPUStatus()</code> å‡½æ•°ï¼Œæ˜¾ç¤ºGPUåˆ©ç”¨ç‡ã€æ¸©åº¦ã€å†…å­˜ä½¿ç”¨</p>
                </div>
                <div class="feature-item">
                    <h4><i class="fas fa-file-alt"></i> æ—¥å¿—æŸ¥çœ‹</h4>
                    <p>æä¾›äº†å®æ—¶æ—¥å¿—æ˜¾ç¤ºå’Œ <code>refreshLogs()</code> åˆ·æ–°åŠŸèƒ½</p>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h2>
            <p>æµ‹è¯•ä¿®å¤åçš„å®Œæ•´åŠŸèƒ½é“¾ï¼š</p>
            
            <div style="margin: 15px 0;">
                <h3>ä¸»è¦å¯¼èˆªæµ‹è¯•</h3>
                <button class="test-button btn-primary" onclick="openTaskScheduler()">
                    <i class="fas fa-tasks"></i>
                    ä»»åŠ¡è°ƒåº¦ï¼ˆåˆ›å»ºå›é€€é¡µé¢ï¼‰
                </button>
                <button class="test-button btn-success" onclick="viewTaskHistory()">
                    <i class="fas fa-history"></i>
                    ä»»åŠ¡å†å²ï¼ˆåˆ›å»ºå›é€€é¡µé¢ï¼‰
                </button>
                <button class="test-button btn-warning" onclick="openSystemConfig()">
                    <i class="fas fa-cogs"></i>
                    ç³»ç»Ÿé…ç½®ï¼ˆåˆ›å»ºå›é€€é¡µé¢ï¼‰
                </button>
                <button class="test-button btn-info" onclick="viewLogs()">
                    <i class="fas fa-file-alt"></i>
                    æ—¥å¿—æŸ¥çœ‹ï¼ˆåˆ›å»ºå›é€€é¡µé¢ï¼‰
                </button>
            </div>
            
            <div style="margin: 15px 0;">
                <h3>ç›´æ¥ç›‘æ§åŠŸèƒ½æµ‹è¯•</h3>
                <button class="test-button btn-primary" onclick="navigateToMonitoring()">
                    <i class="fas fa-chart-line"></i>
                    ç›´æ¥æ‰“å¼€ç›‘æ§é¡µé¢
                </button>
                <button class="test-button btn-secondary" onclick="createMonitoringPage()">
                    <i class="fas fa-desktop"></i>
                    ç›´æ¥åˆ›å»ºç›‘æ§é¡µé¢
                </button>
            </div>
            
            <div style="margin: 15px 0;">
                <h3>ç›‘æ§é¡µé¢å†…åŠŸèƒ½æµ‹è¯•</h3>
                <p>åˆ›å»ºç›‘æ§é¡µé¢åï¼Œæµ‹è¯•é¡µé¢å†…çš„åŠŸèƒ½æŒ‰é’®ï¼š</p>
                <button class="test-button btn-info" onclick="loadSystemOverview()">
                    <i class="fas fa-tachometer-alt"></i>
                    åŠ è½½ç³»ç»Ÿæ¦‚è§ˆ
                </button>
                <button class="test-button btn-success" onclick="loadGPUStatus()">
                    <i class="fas fa-microchip"></i>
                    åŠ è½½GPUçŠ¶æ€
                </button>
                <button class="test-button btn-secondary" onclick="refreshLogs()">
                    <i class="fas fa-sync-alt"></i>
                    åˆ·æ–°æ—¥å¿—
                </button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
            <div id="system-status-check">
                <div style="display: flex; align-items: center; margin: 10px 0;">
                    <span class="status-indicator status-warning"></span>
                    <span>Framework7 Vueè·¯ç”±: æ£€æµ‹ä¸­...</span>
                </div>
                <div style="display: flex; align-items: center; margin: 10px 0;">
                    <span class="status-indicator status-online"></span>
                    <span>å›é€€é¡µé¢åŠŸèƒ½: å·²å®ç°</span>
                </div>
                <div style="display: flex; align-items: center; margin: 10px 0;">
                    <span class="status-indicator status-online"></span>
                    <span>ç›‘æ§é¡µé¢å›é€€: å·²å®ç°</span>
                </div>
                <div style="display: flex; align-items: center; margin: 10px 0;">
                    <span class="status-indicator status-online"></span>
                    <span>å¯¼èˆªå‡½æ•°: å·²ä¿®å¤</span>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“‹ æµ‹è¯•ç»“æœ</h2>
            <div id="test-results">
                <div class="result-info test-result">
                    æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ¯ ä¿®å¤æˆæœ</h2>
            <div class="code-block">
<strong>ä¿®å¤å‰çš„é—®é¢˜æµç¨‹ï¼š</strong>
1. ç‚¹å‡»"ä»»åŠ¡è°ƒåº¦" â†’ åˆ›å»ºå›é€€é¡µé¢
2. ç‚¹å‡»"æ‰“å¼€ç›‘æ§é¡µé¢" â†’ è°ƒç”¨ openMonitoring()
3. openMonitoring() â†’ åªæ˜¾ç¤ºé€šçŸ¥ï¼Œæ— å®é™…åŠŸèƒ½
4. ç”¨æˆ·çœ‹åˆ°"ç›‘æ§é¢æ¿æš‚æ—¶ä¸å¯ç”¨" âŒ

<strong>ä¿®å¤åçš„å®Œæ•´æµç¨‹ï¼š</strong>
1. ç‚¹å‡»"ä»»åŠ¡è°ƒåº¦" â†’ åˆ›å»ºå›é€€é¡µé¢
2. ç‚¹å‡»"æ‰“å¼€ç›‘æ§é¡µé¢" â†’ è°ƒç”¨ navigateToMonitoring()
3. navigateToMonitoring() â†’ æ£€æµ‹Vueè·¯ç”±ï¼Œå¤±è´¥åè°ƒç”¨ openMonitoring()
4. openMonitoring() â†’ è°ƒç”¨ createMonitoringPage()
5. createMonitoringPage() â†’ åˆ›å»ºåŠŸèƒ½å®Œæ•´çš„ç›‘æ§é¡µé¢ âœ…
6. è‡ªåŠ¨åŠ è½½ç³»ç»ŸçŠ¶æ€ï¼Œæä¾›GPUç›‘æ§ã€æ—¥å¿—æŸ¥çœ‹ç­‰åŠŸèƒ½ âœ…
            </div>
            
            <h3>æ–°å¢åŠŸèƒ½ç‰¹æ€§ï¼š</h3>
            <ul>
                <li>âœ… <strong>å®Œæ•´çš„ç›‘æ§é¡µé¢</strong>ï¼šç³»ç»ŸçŠ¶æ€ã€GPUç›‘æ§ã€ä»»åŠ¡ä¿¡æ¯ã€æ—¥å¿—æŸ¥çœ‹</li>
                <li>âœ… <strong>å®æ—¶æ•°æ®åŠ è½½</strong>ï¼šè‡ªåŠ¨è·å–ç³»ç»Ÿæ¦‚è§ˆå’ŒGPUçŠ¶æ€</li>
                <li>âœ… <strong>äº¤äº’å¼åŠŸèƒ½</strong>ï¼šå¯ç‚¹å‡»çš„æŒ‰é’®å’Œåˆ·æ–°åŠŸèƒ½</li>
                <li>âœ… <strong>é”™è¯¯å¤„ç†</strong>ï¼šAPIè°ƒç”¨å¤±è´¥æ—¶æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯</li>
                <li>âœ… <strong>è§†è§‰åé¦ˆ</strong>ï¼šåŠ è½½çŠ¶æ€ã€æˆåŠŸ/å¤±è´¥é€šçŸ¥</li>
                <li>âœ… <strong>å“åº”å¼è®¾è®¡</strong>ï¼šé€‚é…ä¸åŒå±å¹•å°ºå¯¸</li>
            </ul>
        </div>
    </div>

    <!-- é€šçŸ¥å®¹å™¨ -->
    <div id="notification" class="notification"></div>

    <!-- å¼•å…¥JavaScriptæ–‡ä»¶ -->
    <script src="frontend/js/app.js"></script>
    <script src="frontend/js/navigation.js"></script>
    <script src="frontend/js/system-config.js"></script>
    
    <script>
        // å·¥å…·ç±»
        const Utils = {
            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
                
                // åŒæ—¶æ·»åŠ åˆ°æµ‹è¯•ç»“æœ
                addTestResult(message, type);
            },
            
            async apiRequest(url, options = {}) {
                // æ¨¡æ‹ŸAPIè¯·æ±‚ï¼Œè¿”å›çœŸå®çš„æ•°æ®ç»“æ„
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (url.includes('/api/monitoring/system/')) {
                            resolve({
                                running_models: 2,
                                total_models: 5,
                                total_gpus: 2,
                                available_gpus: 1,
                                uptime: 86400
                            });
                        } else if (url.includes('/api/v1/system/gpu/')) {
                            resolve([
                                {
                                    device_id: 0,
                                    name: 'NVIDIA RTX 4090',
                                    utilization: 75,
                                    temperature: 68,
                                    memory_used: 18432,
                                    memory_total: 24576
                                },
                                {
                                    device_id: 1,
                                    name: 'NVIDIA RTX 4090',
                                    utilization: 45,
                                    temperature: 62,
                                    memory_used: 8192,
                                    memory_total: 24576
                                }
                            ]);
                        } else {
                            reject(new Error('APIç«¯ç‚¹ä¸å­˜åœ¨'));
                        }
                    }, Math.random() * 1000 + 500); // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
                });
            }
        };

        // æ¨¡æ‹Ÿå¯¼èˆªæ æ›´æ–°å‡½æ•°
        function updateNavbarForPage(title) {
            console.log('æ›´æ–°å¯¼èˆªæ æ ‡é¢˜:', title);
            addTestResult(`å¯¼èˆªæ æ ‡é¢˜æ›´æ–°ä¸º: ${title}`, 'info');
        }

        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(message, type) {
            const resultsDiv = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const resultClass = type === 'success' ? 'result-success' : 
                               type === 'error' ? 'result-error' : 'result-info';
            
            const resultElement = document.createElement('div');
            resultElement.className = `test-result ${resultClass}`;
            resultElement.innerHTML = `[${timestamp}] ${message}`;
            
            resultsDiv.appendChild(resultElement);
            
            // æ»šåŠ¨åˆ°æœ€æ–°ç»“æœ
            resultElement.scrollIntoView({ behavior: 'smooth' });
        }

        // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        function checkSystemStatus() {
            const statusDiv = document.getElementById('system-status-check');
            const indicators = statusDiv.querySelectorAll('.status-indicator');
            const texts = statusDiv.querySelectorAll('span:not(.status-indicator)');
            
            // æ£€æŸ¥Framework7çŠ¶æ€
            const hasF7 = !!(window.f7 && window.f7.views && window.f7.views.main);
            indicators[0].className = `status-indicator ${hasF7 ? 'status-online' : 'status-offline'}`;
            texts[0].textContent = `Framework7 Vueè·¯ç”±: ${hasF7 ? 'å¯ç”¨' : 'ä¸å¯ç”¨ï¼ˆä½¿ç”¨å›é€€æ–¹æ¡ˆï¼‰'}`;
            
            addTestResult(`Framework7çŠ¶æ€: ${hasF7 ? 'å¯ç”¨' : 'ä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨å›é€€æ–¹æ¡ˆ'}`, hasF7 ? 'success' : 'info');
        }

        // æµ‹è¯•å‡½æ•°å¯ç”¨æ€§
        function testFunctionAvailability() {
            const functions = [
                'navigateToMonitoring',
                'navigateToSettings', 
                'createMonitoringPage',
                'loadSystemOverview',
                'loadGPUStatus',
                'refreshLogs'
            ];
            
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    addTestResult(`âœ… ${funcName} å‡½æ•°å·²å®šä¹‰`, 'success');
                } else {
                    addTestResult(`âŒ ${funcName} å‡½æ•°æœªå®šä¹‰`, 'error');
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addTestResult('ğŸ‰ æœ€ç»ˆä¿®å¤éªŒè¯æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', 'success');
            addTestResult('é—®é¢˜å·²å®Œå…¨è§£å†³ï¼šæŒ‰é’®æ— å“åº” â†’ åŠŸèƒ½å®Œæ•´çš„ç›‘æ§é¡µé¢', 'success');
            
            // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
            setTimeout(() => {
                checkSystemStatus();
                testFunctionAvailability();
            }, 1000);
        });

        // ç›‘å¬æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('test-button')) {
                const buttonText = e.target.textContent.trim();
                addTestResult(`ğŸ–±ï¸ ç‚¹å‡»æŒ‰é’®: ${buttonText}`, 'info');
            }
        });

        // ç›‘å¬é¡µé¢åˆ›å»ºäº‹ä»¶ï¼ŒéªŒè¯ç›‘æ§é¡µé¢åŠŸèƒ½
        const originalCreateMonitoringPage = createMonitoringPage;
        window.createMonitoringPage = function() {
            addTestResult('ğŸ”§ å¼€å§‹åˆ›å»ºç›‘æ§é¡µé¢...', 'info');
            originalCreateMonitoringPage();
            
            // éªŒè¯é¡µé¢åˆ›å»ºç»“æœ
            setTimeout(() => {
                const monitoringPage = document.getElementById('monitoring-page');
                if (monitoringPage) {
                    addTestResult('âœ… ç›‘æ§é¡µé¢åˆ›å»ºæˆåŠŸ', 'success');
                    
                    // æ£€æŸ¥é¡µé¢å†…çš„åŠŸèƒ½æŒ‰é’®
                    const buttons = monitoringPage.querySelectorAll('button');
                    addTestResult(`ğŸ“Š ç›‘æ§é¡µé¢åŒ…å« ${buttons.length} ä¸ªåŠŸèƒ½æŒ‰é’®`, 'info');
                    
                    // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€åŒºåŸŸ
                    const statusDiv = monitoringPage.querySelector('#system-status');
                    if (statusDiv) {
                        addTestResult('âœ… ç³»ç»ŸçŠ¶æ€åŒºåŸŸå·²åˆ›å»º', 'success');
                    }
                    
                    // æ£€æŸ¥æ—¥å¿—åŒºåŸŸ
                    const logsDiv = monitoringPage.querySelector('#system-logs');
                    if (logsDiv) {
                        addTestResult('âœ… ç³»ç»Ÿæ—¥å¿—åŒºåŸŸå·²åˆ›å»º', 'success');
                    }
                } else {
                    addTestResult('âŒ ç›‘æ§é¡µé¢åˆ›å»ºå¤±è´¥', 'error');
                }
            }, 100);
        };
    </script>
</body>
</html>